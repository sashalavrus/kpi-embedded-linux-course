
Лабораторна робота №5 
====
Тема: Робота з чергою задач
====
Завдання:
===
- Подивитися відео, розібратися з Work queue
- Написати модуль ядра, який приймає аргументи th_val, wrk_val і jffdelay, реалізує два потоки і ворк (в дефолтних work queue), а також таймер (на базі timer wheel)
- Запускає таймер і ворк
- При спрацьовуванні таймера перевіряє поточне значення jiffies, якщо воно кратно th_val - зупинити перший потік; інакше - таймер перезапускається через jffdelay jiffies
- Усередині Ворку перевіряє поточне значення jiffies, якщо воно кратно wrk_val - зупинити другий потік; інакше - ворк повинен заснути на jffdelay jiffies і перезапустити себе.
- Перевірити роботу. Для th_val і wrk_val бажано вибирати прості числа
- Додати два зв'язкових списку, в які аллоціровать і додавати елементи зі значеннями jiffies які не привели до завершення першого і другого потоків відповідно. Виходить зв'язок "таймер - 1й список - 1й потік" і "ворк - 2й список - 2й потік"
- При виході з потоку роздрукувати список
- Усередині Ворку і таймера використовувати правильні аллокации для нових елементів списку, правильну синхронізацію доступу до списку
- Передбачити, що користувач може вивантажити модуль достроково

Хід роботи:
====

В даній роботі було створено чергу задач та таймер, які сіли на два потоки.
Для запуску модуля потрібно спочатку скомпілювати його:
`make KBUILDDIR="<KBuild directory>"`

Запускаємо ядро за допомогою QEMU:
`qemu-system-x86_64 -enable-kvm -m 512M -smp 4 -kernel "<bzImage path>" -initrd "<path BusyBox shell utilits .gz>" \
                    -append "console=ttyS0" -nographic \
                    -drive file=fat:rw:./<path to module>,format=raw,media=disk`
                    
Підготовчі дії:
`mkdir mnt`
`mount -t vfat /dev/sda1 /mnt`

Запуск модуля:
`insmode /mnt/<module_name.ko>`

Вигрузка модуля:
`rmmod <module_name>`

Висновки:
===

В ході виконання лабараторної роботи було завоєна робота з потоками ядра. Також було засвоєно роботу з чергою задач. Результат виконная модуля видно нижче 

```
/ # insmod /mnt/lab5.ko th_val=3 wrk_val=5 jffdelay=10
/ # rmmod lab5
[  107.111499] Exit jiffies is 4294774265
[  107.114350] Timer fail in jiff = 4294772532
[  107.114352] Queue fail in jiff = 4294772532
[  107.116843] Queue fail in jiff = 4294772543
[  107.118851] Queue fail in jiff = 4294772554
[  107.119856] lab5: exit
[  107.121259
```
